<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Architecture &#8212; exodus-lambda  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=19a2ea7e" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=4ae1632d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Deployment" href="deploy.html" />
    <link rel="prev" title="exodus-lambda" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="architecture">
<span id="arch-ref"></span><h1>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>This diagram shows the relationship between all major components used
in the delivery of content via the CDN.</p>
<div class="graphviz"><img src="_images/graphviz-9255cc618e69ee0d1da679f6c07846623f14ba8f.png" alt="digraph {
    ranksep=&quot;1.4&quot;;

    # These are arranged and labelled to communicate the
    # sequence of events when a request is processed.
    # Try to keep them in this order.
    client:sw -&gt; controller [
        xlabel=&lt; &lt;table bgcolor=&quot;white&quot; border=&quot;0&quot; cellborder=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;rounded&quot;&gt;&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; &gt;
    ]

    controller:sw -&gt; origin_request [
        xlabel=&lt; &lt;table bgcolor=&quot;white&quot; border=&quot;0&quot; cellborder=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;rounded&quot;&gt;&lt;tr&gt;&lt;td&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; &gt;
    ]

    origin_request -&gt; dbcontent [
        xlabel=&lt; &lt;table bgcolor=&quot;white&quot; border=&quot;0&quot; cellborder=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;rounded&quot;&gt;&lt;tr&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; &gt;,
        dir=both
    ]

    origin_request -&gt; dbconfig [
        # This connection doesn't get a number since the reading of config is not
        # directly tied to the lifecycle of a request.
        dir=both
    ]

    origin_request -&gt; controller:s [
        xlabel=&lt; &lt;table bgcolor=&quot;white&quot; border=&quot;0&quot; cellborder=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;rounded&quot;&gt;&lt;tr&gt;&lt;td&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; &gt;
    ]

    controller -&gt; S3 [
        xlabel=&lt; &lt;table bgcolor=&quot;white&quot; border=&quot;0&quot; cellborder=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;rounded&quot;&gt;&lt;tr&gt;&lt;td&gt;5&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; &gt;,
        dir=both
    ]

    controller:se -&gt; origin_response [
        xlabel=&lt; &lt;table bgcolor=&quot;white&quot; border=&quot;0&quot; cellborder=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;rounded&quot;&gt;&lt;tr&gt;&lt;td&gt;6&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; &gt;,
        dir=both
    ]

    controller -&gt; client:se [
        xlabel=&lt; &lt;table bgcolor=&quot;white&quot; border=&quot;0&quot; cellborder=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;rounded&quot;&gt;&lt;tr&gt;&lt;td&gt;7&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; &gt;
    ]

    # publishing tools are mentioned, but do not participate
    # in the request processing.
    # Connection order here is reversed to force the publishing tools to the bottom
    # of the graph, which makes them stand out a bit more.
    S3:s -&gt; exodus_gw:ne [dir=&quot;back&quot;]
    dbcontent:s -&gt; exodus_gw:nw [dir=&quot;back&quot;]
    dbconfig -&gt; exodus_gw [dir=&quot;both&quot;]

    exodus_gw -&gt; exodus_rsync:n [dir=&quot;back&quot;];
    exodus_gw -&gt; native_tools:n [dir=&quot;back&quot;];
    exodus_rsync -&gt; legacy_tools:n [dir=&quot;back&quot;];

    client [label=&quot;client&quot;]
    exodus_gw [label=&quot;exodus-gw&quot;];
    exodus_rsync [label=&quot;exodus-rsync&quot;];
    legacy_tools [label=&quot;publishing tools (rsync)&quot;, style=&quot;dashed&quot;];
    native_tools [label=&quot;publishing tools (exodus)&quot;, style=&quot;dashed&quot;];

    dbcontent [
        shape=plaintext
        fontsize=9
        label=&lt;

            &lt;table border='1' cellborder='1' cellspacing='0'&gt;
                &lt;tr&gt;&lt;td colspan='4'&gt;&lt;font point-size=&quot;14&quot;&gt;&lt;b&gt;☁ DynamoDB (content)&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;b&gt;web_uri&lt;/b&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;b&gt;from_date&lt;/b&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;b&gt;object_key&lt;/b&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;b&gt;content_type&lt;/b&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;/content/dist/rhel/server/7/7Server/x86_64/os/Packages/t/tar-1.26-34.el7.x86_64.rpm&lt;/td&gt;
                    &lt;td&gt;2020-03-26T01:07:39+00:00&lt;/td&gt;
                    &lt;td&gt;8e7750e50734f...&lt;/td&gt;
                    &lt;td&gt;application/x-rpm&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;/content/dist/rhel/server/7/7Server/x86_64/os/Packages/z/zlib-1.2.7-18.el7.x86_64.rpm&lt;/td&gt;
                    &lt;td&gt;2020-03-26T01:07:39+00:00&lt;/td&gt;
                    &lt;td&gt;db8dd5164d117...&lt;/td&gt;
                    &lt;td&gt;application/x-rpm&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;/content/dist/rhel/server/7/7Server/x86_64/os/repodata/repomd.xml&lt;/td&gt;
                    &lt;td&gt;2020-03-26T01:07:39+00:00&lt;/td&gt;
                    &lt;td&gt;aec070645fe53...&lt;/td&gt;
                    &lt;td&gt;application/xml&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;/content/dist/rhel/server/7/7Server/x86_64/os/repodata/repomd.xml&lt;/td&gt;
                    &lt;td&gt;2020-01-22T02:07:20+00:00&lt;/td&gt;
                    &lt;td&gt;5d70f436aa013...&lt;/td&gt;
                    &lt;td&gt;application/xml&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;&lt;td colspan='4'&gt;...&lt;/td&gt;&lt;/tr&gt;
            &lt;/table&gt;
        &gt;
    ];

    dbconfig [
        shape=plaintext
        fontsize=9
        label=&lt;
            &lt;table border='1' cellborder='1' cellspacing='0'&gt;
                &lt;tr&gt;&lt;td colspan='4'&gt;&lt;font point-size=&quot;14&quot;&gt;&lt;b&gt;☁ DynamoDB (config)&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;&lt;b&gt;config_id&lt;/b&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;b&gt;from_date&lt;/b&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;b&gt;config&lt;/b&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;exodus-config&lt;/td&gt;
                    &lt;td&gt;2023-08-04 21:05:40&lt;/td&gt;
                    &lt;td&gt;{&quot;listing&quot;: {&quot;/content/dist/rhel8&quot;: {...&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td&gt;exodus-config&lt;/td&gt;
                    &lt;td&gt;2023-08-07 21:20:31&lt;/td&gt;
                    &lt;td&gt;{&quot;listing&quot;: {&quot;/content/dist/rhel8&quot;: {...&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;&lt;td colspan='4'&gt;...&lt;/td&gt;&lt;/tr&gt;
            &lt;/table&gt;
        &gt;
    ];

    S3 [
        shape=plaintext
        fontsize=9
        label=&lt;

                &lt;table border='1' cellborder='1' cellspacing='0'&gt;
                    &lt;tr&gt;&lt;td colspan='2'&gt;&lt;font point-size=&quot;14&quot;&gt;&lt;b&gt;☁ S3&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;&lt;b&gt;key&lt;/b&gt;&lt;/td&gt;
                        &lt;td&gt;&lt;b&gt;object&lt;/b&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;8e7750e50734f...&lt;/td&gt;
                        &lt;td&gt;&lt;i&gt;[blob tar-1.26-34.el7.x86_64.rpm]&lt;/i&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;db8dd5164d117...&lt;/td&gt;
                        &lt;td&gt;&lt;i&gt;[blob zlib-1.2.7-18.el7.x86_64.rpm]&lt;/i&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;aec070645fe5...&lt;/td&gt;
                        &lt;td&gt;&lt;i&gt;[blob some repomd.xml]&lt;/i&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;5d70f436aa01...&lt;/td&gt;
                        &lt;td&gt;&lt;i&gt;[blob other repomd.xml]&lt;/i&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;
                        &lt;td&gt;49ae93732fcf...&lt;/td&gt;
                        &lt;td&gt;&lt;i&gt;[blob some primary.sqlite.bz2]&lt;/i&gt;&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;tr&gt;&lt;td colspan='2'&gt;...&lt;/td&gt;&lt;/tr&gt;
                &lt;/table&gt;
        &gt;
    ];

    subgraph cluster_0 {
        label=&lt; &lt;b&gt;CloudFront CDN&lt;/b&gt; &gt;
        style=&quot;rounded&quot;;
        controller;
        subgraph cluster_1 {
            label=&lt;&lt;b&gt;exodus-lambda&lt;/b&gt;&gt;;
            style=&quot;dashed&quot;;
            rank=same
            origin_request;
            origin_response;
        }
    }

    subgraph cluster_10 {
        label=&lt; &lt;b&gt;publishing tools&lt;/b&gt; &gt;
        style=&quot;dashed,rounded&quot;;
        exodus_gw;
        exodus_rsync;
        subgraph cluster_11 {
            label=&quot;&quot;;
            style=&quot;invis&quot;;
            rank=same;
            legacy_tools;
            native_tools;
        }
    }

    # both DynamoDB and S3 would normally be on the same rank, which makes
    # the diagram way too wide. This ought to help by shifting the config
    # table downwards.
    { rank=same; exodus_gw; dbconfig; }
}" class="graphviz" /></div>
<ul class="simple">
<li><p>Numbered connections represent the sequence of events when the CDN processes
a request.</p></li>
<li><p>For clarity, SHA256 checksums have been truncated (as in
<code class="docutils literal notranslate"><span class="pre">8e7750e50734f...</span></code>). In reality, the system stores complete checksums.</p></li>
<li><p>The CloudFront CDN shown in the above diagram may itself be hosted behind
another CDN, so client requests may pass through additional layers not
expressed here.</p></li>
</ul>
</section>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Link to this heading">¶</a></h2>
<dl>
<dt>client</dt><dd><p>A client requesting data from the CDN.</p>
<p>This could be <code class="docutils literal notranslate"><span class="pre">dnf</span></code>, <code class="docutils literal notranslate"><span class="pre">yum</span></code>, Satellite, <code class="docutils literal notranslate"><span class="pre">curl</span></code>, a web browser, etc.</p>
</dd>
<dt>CloudFront CDN</dt><dd><p>The <a class="reference external" href="https://aws.amazon.com/cloudfront/">Amazon CloudFront</a> content delivery network.</p>
</dd>
<dt>controller</dt><dd><p>An abstract component representing the built-in behaviors of CloudFront,
such as:</p>
<ul class="simple">
<li><p>basic HTTP request handling</p></li>
<li><p>serving responses from cache</p></li>
<li><p>invoking Lambda functions</p></li>
<li><p>delegating requests to S3</p></li>
</ul>
<p>…and so on.</p>
</dd>
<dt>DynamoDB</dt><dd><p><a class="reference external" href="https://aws.amazon.com/dynamodb/">Amazon DynamoDB</a> NoSQL database service.</p>
</dd>
<dt>DynamoDB (content)</dt><dd><p>A DynamoDB table which primarily contains mappings between URIs and S3 object
keys. Used to look up content. Where multiple matches exist for the same URI,
the latest item is used.</p>
<p>For more information about the data contained here, see <a class="reference internal" href="schema-reference.html#schema-ref"><span class="std std-ref">Schema Reference</span></a>.</p>
</dd>
<dt>DynamoDB (config)</dt><dd><p>A DynamoDB table which holds configuration influencing the behavior of the CDN.
Examples of configuration include the variables needed to respond to <cite>/listing</cite>
requests, and information on aliases between paths (emulating symlinks between
directories).</p>
</dd>
<dt>S3</dt><dd><p><a class="reference external" href="https://aws.amazon.com/s3/">Amazon S3</a>, Simple Storage Service.</p>
<p>The CDN uses S3 to store the binary objects retrievable by clients.
A single bucket is used, configured as the origin of the CloudFront CDN.</p>
<p>One object corresponds to one file which can be downloaded from the CDN;
this includes files considered to be content (such as RPMs) and files
considered to be metadata (such as yum repo metadata files).</p>
<p>Each object’s key is its own SHA256 checksum, ensuring that content
accessible via many paths on the CDN need only be stored once.</p>
<p>For more information about the data contained here, see <a class="reference internal" href="schema-reference.html#schema-ref"><span class="std std-ref">Schema Reference</span></a>.</p>
</dd>
<dt>exodus-lambda</dt><dd><p>A project including Python-based implementations of <a class="reference external" href="https://aws.amazon.com/lambda/edge/">Lambda&#64;Edge</a>
functions for the CDN.</p>
<p>You are currently reading the documentation of this project.</p>
</dd>
<dt>origin_request</dt><dd><p>A <a class="reference external" href="https://aws.amazon.com/lambda/edge/">Lambda&#64;Edge</a> function connected to “origin request” events in
CloudFront.</p>
<p>This function is primarily responsible for translating the path given in
the client’s request into an S3 object key via a DynamoDB query.  Assuming
the client has requested existing content, this Lambda function will
rewrite the request’s URI into a valid S3 object key before returning the
request to the controller. The function itself does not request data from
S3, nor generate a response directly in the typical case (although it does
for some edge cases).</p>
<p>For more information about this function’s behavior, see
<a class="reference internal" href="function-reference.html#function-ref"><span class="std std-ref">Function Reference</span></a>.</p>
</dd>
<dt>origin_response</dt><dd><p>A <a class="reference external" href="https://aws.amazon.com/lambda/edge/">Lambda&#64;Edge</a> function connected to “origin response” events in
CloudFront.</p>
<p>This function is primarily responsible for tweaking certain response
headers before allowing CloudFront to serve the response to clients. For
example, caching behavior is influenced by setting a Cache-Control header
for certain responses.</p>
<p>For more information about this function’s behavior, see
<a class="reference internal" href="function-reference.html#function-ref"><span class="std std-ref">Function Reference</span></a>.</p>
</dd>
<dt><a class="reference external" href="https://release-engineering.github.io/exodus-gw/">exodus-gw</a></dt><dd><p>A microservice dedicated to writing data onto the CDN, this component
exposes an HTTP API for use by publishing tools, and enforces certain
policies on published content.</p>
<p>It is the only component permitted to perform writes on DynamoDB and S3
(hence, the “exodus gateway”).</p>
</dd>
<dt><a class="reference external" href="https://github.com/release-engineering/exodus-rsync">exodus-rsync</a></dt><dd><p>A drop-in replacement for the <code class="docutils literal notranslate"><span class="pre">rsync</span></code> command. This command has
an interface which is partially compatible with <code class="docutils literal notranslate"><span class="pre">rsync</span></code>, but it
performs publishes via API calls to <code class="docutils literal notranslate"><span class="pre">exodus-gw</span></code> rather than using
the rsync protocol.</p>
<p>exodus-rsync is not fully rsync-compatible; it is engineered to support
specific known publishing tools designed for rsync.</p>
</dd>
<dt>publishing tools (rsync)</dt><dd><p>Represents tools used by Red Hat to publish content onto the CDN which
are designed to use rsync and are mostly unaware of the Exodus CDN
architecture. These tools are made to publish to Exodus CDN by replacing
the <code class="docutils literal notranslate"><span class="pre">rsync</span></code> command with <code class="docutils literal notranslate"><span class="pre">exodus-rsync</span></code>.</p>
<p>RHSM Pulp is an example of a publishing tool using rsync.</p>
</dd>
<dt>publishing tools (exodus)</dt><dd><p>Represents tools used by Red Hat to publish content onto the CDN which
are explicitly designed for Exodus CDN.</p>
<p>These tools don’t need to use the <code class="docutils literal notranslate"><span class="pre">exodus-rsync</span></code> compatibility layer,
and so may have improved performance or an extended feature set when
compared with tools using rsync.</p>
</dd>
</dl>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">exodus-lambda</a></h1>



<p class="blurb">AWS Lambda functions for Red Hat's Content Delivery Network</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#components">Components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="function-reference.html">Function Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema-reference.html">Schema Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Tests</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/release-engineering/exodus-lambda">Source</a></li>
    
    <li class="toctree-l1"><a href="genindex.html">Index</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">exodus-lambda</a></li>
      <li>Next: <a href="deploy.html" title="next chapter">Deployment</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2020, Red Hat.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/arch.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/release-engineering/exodus-lambda" class="github">
        <img src="_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>